##  로그 수집 가이드 (2-tier, 3-tier)



로그 수집하는데 있어 Fluentd를 사용하는데, 데이터 파이프라인 구조를 2-tier, 3-tier 형태로 가져갈 수 있다.

2-tier

- 로그 수집 서버 (Fluentd) --> 저장소 (HDFS)

3-tier

- 로그 수집 서버 (Fluentd) --> Collector, Message Queue (Fluentd, Kafka) --> 저장소 (HDFS)



2-tier 방식을 하면 로그를 바로 저장소로 저장하기 때문에, 3-tier 방식보단 빠르게 데이터를 저장할 수 있다. 

하지만 아래 단점들이 있다.

1. 향후 로그 수집 서버가 늘어날 수 있는데, 이는 저장소에 수 많은 TCP Connection이 비례하여 발생하는데, 부하 관리에 효율적이지 못한다.
2. 저장소쪽에 문제가 발생하면 로그를 버퍼에 쌓기 시작하는데, 만약 버퍼가 다 채워지면 데이터 유실이 발생할 수 있다.

3. 향후 저장소의 종류가 많아질수록, 로그 수집 서버에 있는 Fluentd들의 Config가 계속 바뀌고 이를 적용하기 위해 재시작이 되어야 한다. 즉, 이는 다른 저장소에도 영향이 갈 수 있다.



3-tier 방식은 2-tier에 비해 지연 시간은 더 늘어날 것이다. 하지만, 관리 포인트도 줄일 수 있고 안정적으로 운영이 가능하다.

결론적으로, 간단하게 구축할 생각이면 2-tier 방식으로 빠르게 시스템을 구축할 수 있지만, 향후 시스템의 안정성을 위해 3-tier로 가는 것이 옳다.