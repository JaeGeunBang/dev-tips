### hadoop distcp 이슈

<hr>


hadoop distcp 를 아래와 같이 수행했을때,

```
> hadoop distcp /logs/source /logs/desc
```



아래와 같은 이슈가 발생한다.

```
Check-sum mismatch between hdfs://... and hdfs://...
```

아무래도 source, desc 사이의 check-sum 체크 결과 실패했다는 의미로 보인다.



이를 위해 아래와 같이 distcp를 수행한다.

```
> hadoop distcp -pb -skipcrccheck /logs/source /logs/desc
```

`checksum-check`는 skip할 수 있으나 이는 문제가 생길수 있어서, `-pb` 옵션을 통해 block-size를 보존할 수 있다. 만약 보존하지 않는다면 복사시 데이터 유실이 발생할 수 있다.



이외에 복사하는 방법은 크게 3가지가 있다.

- `-update`
  - source, destination의 blocksize, checksum, size가 서로 다를 경우 overwrite 한다.
  - **blocksize, checksum, size가 완전 똑같은 파일이 있다면 무시하고 그렇지 않는 파일들만 덮어씌운다는 의미**.
  - 참고로 Sync를 위한 operation이 아니다.
- `-overwrite`
  - destination으로 그냥 overwrite 한다.
  - **같은 파일이 있든간에 그냥 덮어씌운다는 의미**
- `-append`
  - destination에 같은 이름을 가진 파일이 있다면 incremental copy를 한다.
  - **즉, 같은 이름의 파일이지만, 크기가 다르다면 해당 파일에 append 하겠다는 의미**



### 참고 

https://hadoop.apache.org/docs/current/hadoop-distcp/DistCp.html